#!/bin/bash

set -e
. /lib/lsb/init-functions
export JAVA_HOME=/usr/share/java/
export AWS_ACCESS_KEY_ID=<%= node[:awsAccessKeyId] %>
export AWS_SECRET_KEY=<%= node[:awsSecretKey] %>

case $1 in
  start)
    java -jar /opt/kinesis_to_s3/kinesis-to-s3.jar /opt/kinesis_to_s3/kinesis-to-s3.properties &>/var/log/kinesis.log &
    echo $! > /var/run/kinesis-to-s3.pid
    ;;
  stop)
    kill `cat /var/run/kinesis-to-s3.pid`
    rm -f /var/run/kinesis-to-s3.pid
    ;;
  *)
    echo "usage: kinesis-to-s3 {start|stop}" ;;
esac

exit 0
